/**
 * --------------------------------------------------------------------------
 * Fork from Bootstrap (v4-without-jquery): dom/data.js
 * --------------------------------------------------------------------------
 */

import AbstractComponent from './abstract-component';

const mapData = ((): { set: Function; get: Function; delete: Function } => {
  const storeData = {};
  let id = 1;
  return {
    set(element, key: string, data: AbstractComponent): void {
      if (typeof element.key === 'undefined') {
        element.key = {
          key,
          id
        };
        id++;
      }

      storeData[element.key.id] = data;
    },
    get(element, key: string): AbstractComponent {
      if (!element || typeof element.key === 'undefined') {
        return null;
      }

      const keyProperties = element.key;
      if (keyProperties.key === key) {
        return storeData[keyProperties.id];
      }

      return null;
    },
    delete(element, key: string): void {
      if (typeof element.key === 'undefined') {
        return;
      }

      const keyProperties = element.key;
      if (keyProperties.key === key) {
        delete storeData[keyProperties.id];
        delete element.key;
      }
    }
  };
})();

const Data = {
  setData(instance, key: string, data: AbstractComponent): void {
    mapData.set(instance, key, data);
  },
  getData(instance, key: string): AbstractComponent {
    return mapData.get(instance, key);
  },
  removeData(instance, key: string): void {
    mapData.delete(instance, key);
  }
};

export default Data;
